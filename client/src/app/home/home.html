<div class="container">
  <div class="filter-bar mb-4">
    <div class="row gy-2 gx-3 align-items-center">
      <div class="col-auto">
        <label for="subjectFilter" class="visually-hidden">Subject</label>
        <select id="subjectFilter" class="form-select" [(ngModel)]="selectedSubjectId" (ngModelChange)="onFilterChange()">
          <option [ngValue]="null">All Subjects</option>
          @for (subject of subjects; track subject._id) {
            <option [ngValue]="subject._id">{{ subject.name }}</option>
          }
        </select>
      </div>
      <div class="col-auto">
        <label for="topicFilter" class="visually-hidden">Topic</label>
        <select id="topicFilter" class="form-select" [(ngModel)]="selectedTopicId" (ngModelChange)="onFilterChange()">
          <option [ngValue]="null">All Topics</option>
          @for (topic of topics; track topic._id) {
            <option [ngValue]="topic._id">{{ topic.name }}</option>
          }
        </select>
      </div>
      <div class="col-sm-4">
        <label for="searchFilter" class="visually-hidden">Search</label>
        <div class="input-group">
          <span class="input-group-text">
            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#667085"><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg>
          </span>
          <input type="text" id="searchFilter" class="form-control" placeholder="Search flashcards..." [(ngModel)]="searchTerm" (input)="onSearchTermChange()">
        </div>
      </div>
      <div class="col-auto">
        <div class="btn-group" role="group">
          <button type="button" class="btn btn-outline-primary border-bootstrap-btn-custom" (click)="setSortBy('title')" [class.active]="sortBy === 'title'">
            Name
            @if (sortBy === 'title') {
              @if (sortDirection === 'desc') {
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M440-160v-487L216-423l-56-57 320-320 320 320-56 57-224-224v487h-80Z"/></svg>
              } @else {
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M440-800v487L216-537l-56 57 320 320 320-320-56-57-224 224v-487h-80Z"/></svg>
              }
            }
          </button>
          <button type="button" class="btn btn-outline-primary border-bootstrap-btn-custom" (click)="setSortBy('createdAt')" [class.active]="sortBy === 'createdAt'">
            Date
            @if (sortBy === 'createdAt') {
              @if (sortDirection === 'desc') {
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M440-160v-487L216-423l-56-57 320-320 320 320-56 57-224-224v487h-80Z"/></svg>
              } @else {
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M440-800v487L216-537l-56 57 320 320 320-320-56-57-224 224v-487h-80Z"/></svg>
              }
            }
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="flashcard-grid">
    @for (card of flashcards; track card._id) {
      <div class="card flashcard" [style.border-top-color]="getCardColor(card)">
        <div class="flashcard-title">
          <h5 class="card-title">{{ card.title }}</h5>
        </div>
        <div class="flashcard-body">
          <p class="flashcard-text">{{ getCardBody(card) }}</p>
          <div class="flashcard-actions">
            <button class="btn btn-primary" (click)="seeAnswer(card)">
              {{ getCardButtonText(card) }}
            </button>
            <button type="button" class="btn btn-outline-danger" (click)="deleteCard(card)">
              <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">
                <path d="M280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160 0h80v-360h-80v360ZM280-720v520-520Z"/>
              </svg>
            </button>
            <button type="button" class="btn btn-outline-warning" (click)="modifyCard(card)">
              <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">
                <path d="M200-200h57l391-391-57-57-391 391v57Zm-80 80v-170l528-527q12-11 26.5-17t30.5-6q16 0 31 6t26 18l55 56q12 11 17.5 26t5.5 30q0 16-5.5 30.5T817-647L290-120H120Zm640-584-56-56 56 56Zm-141 85-28-29 57 57-29-28Z"/>
              </svg>
            </button>
            <button type="button" class="btn btn-outline-success" (click)="copyCard(card)">
              <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">
                <path d="M360-240q-33 0-56.5-23.5T280-320v-480q0-33 23.5-56.5T360-880h360q33 0 56.5 23.5T800-800v480q0 33-23.5 56.5T720-240H360Zm0-80h360v-480H360v480ZM200-80q-33 0-56.5-23.5T120-160v-560h80v560h440v80H200Zm160-240v-480 480Z"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
    }
  </div>
</div>

<app-toast></app-toast>